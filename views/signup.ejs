<%- include('partials/header'); -%>
<div class="container white">
    <div class="container" style="padding: 12px;margin-top: 100px">
        <form>
            <h2 class="indigo-text center">Sign Up</h2>

            <div class="input-field">
                <i class="material-icons prefix">person</i>
                <input type="text" id="name" required />
                <label for="name">Name</label>
            </div>

            <div class="input-field">
                <i class="material-icons prefix">phone_android</i>
                <input type="text" id="mobile" required />
                <label for="mobile">Mobile</label>
            </div>
            
            <div class="input-field">
                <i class="material-icons prefix">handle</i>
                <input type="text" id="handle" required />
                <label for="handle">Handle</label>
                <div class="handle error"></div>
            </div>

            <div class="input-field">
                <i class="material-icons prefix">email</i>
                <input type="text" id="email" required />
                <label for="email">Email</label>
                <div class="email error"></div>
            </div>

            <!-- I replaced name="email" with id="email" could lead to errors -->
            <div class="input-field">
                <i class="material-icons prefix">lock</i>
                <input type="text" id="password" required />
                <label for="password">Password</label>
                <div class="password error"></div>
            </div>

            <div class="input-field">
                <i class="material-icons prefix">lock</i>
                <input type="text" id="confirm-password" required />
                <label for="confirm-password">Confirm Password</label>
                <!-- Create Error div -->
            </div>
            
            <div class="center">
                <button class="btn indigo center">Sign Up</button>
            </div>
        </form>

        <script>
            const form = document.querySelector('form');
            const emailError = document.querySelector('.email.error');
            const passwordError = document.querySelector('.password.error');
            const handleError = document.querySelector('.handle.error');
            // TODO: add CSS to the error display and don't display on undefined

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
      
                // get the values from the form
                const email = form.email.value;
                const handle = form.handle.value;
                const password = form.password.value;
                const name = form.name.value;
                const mobile = parseInt(form.mobile.value);


                //reset errors
                emailError.innerHTML = "";
                passwordError.innerHTML = "";
                handleError.innerHTML = "";
                console.log(email, password, name, mobile, handle);
                try{
                    const res = await fetch('/signup', {
                        method: 'POST',
                        body: JSON.stringify({email: email, password: password, name: name, mobile: mobile, handle: handle}),
                        headers: {'Content-Type': 'application/json'}
                    });
                    const data = await res.json();
                    console.log(data);
                    if(data.errors)
                    {
                        emailError.innerHTML = data.errors.email;
                        handleError.innerHTML = data.errors.handle;
                        passwordError.innerHTML =data.errors.password;
                    }
                    if(data.name)
                    {
                        location.assign('/profile');
                    }

                }catch(err){
                    console.log('1');
                    console.log(err);
                }

                
            })
        </script>
    </div>


</div>
<%- include('partials/footer'); -%>